<!DOCTYPE html>
<html>

<head>
    <title>Stage Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            width: 80%;
            max-width: 600px;
        }

        select, input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .process-container {
            display: none;
        }

        #calculateButton {
            display: block;
            margin: 0 auto;
            padding: 10px 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #calculateButton:hover {
            background-color: #0056b3;
        }

        .result {
            margin-left: 10px;
        }

    </style>
</head>

<body>
    <div class="container">
        <h1>Stage Calculator</h1>

        <label for="stage">Select Stage:</label>
        <select id="stage">
            <option value="1">Stage 1</option>
            <option value="2">Stage 2</option>
            <option value="3">Stage 3</option>
            <option value="4">Stage 4</option>
        </select>

        <div id="process-container" class="process-container">
            <label for="processCount">How many processes do you want to calculate?</label>
            <input type="number" id="processCount" min="1" value="1">
        </div>

        <div id="process-type-container" class="process-container">
            <p>Choose the type for each process:</p>
            <div id="processTypes"></div>
        </div>

        <p id="totalSum"></p>
    </div>

    <script>
        const stageSelect = document.getElementById('stage');
        const processContainer = document.getElementById('process-container');
        const processTypeContainer = document.getElementById('process-type-container');
        const processCountInput = document.getElementById('processCount');
        const processTypesContainer = document.getElementById('processTypes');

        function updateTotal(stage) {
            const results = Array.from(document.querySelectorAll('.result'));
            let totalSum = results.reduce((acc, result) => acc + parseFloat(result.textContent), 0);
            localStorage.setItem(`totalForStage${stage}`, totalSum);
            document.getElementById('totalSum').textContent = `Total Sum for Stage ${stage}: ${totalSum}`;
        }

        stageSelect.addEventListener('change', () => {
            const stage = stageSelect.value;
            if (stage === '1' || stage === '2' || stage === '3' || stage === '4') {
                processContainer.style.display = 'block';
                processTypeContainer.style.display = 'none';
                processCountInput.value = '1';
                processTypesContainer.innerHTML = '';
                document.getElementById('totalSum').textContent = `Total Sum for Stage ${stage}: ${localStorage.getItem(`totalForStage${stage}`) || 0}`;
            }
        });

        processCountInput.addEventListener('change', () => {
            const processCount = parseInt(processCountInput.value, 10);
            processTypesContainer.innerHTML = '';

            for (let i = 0; i < processCount; i++) {
                const processDiv = document.createElement('div');
                processDiv.style.display = 'flex';
                processDiv.style.alignItems = 'center';
                processDiv.style.justifyContent = 'space-between';

                const processTypeSelect = document.createElement('select');
                processTypeSelect.name = `processType${i}`;
                processTypeSelect.id = `processType${i}`;
                processTypeSelect.innerHTML = `
                <option value="control_move">Control Move</option>
                <option value="general_move">General Move</option>
                <option value="tool_use">Tool Use</option>
                `;

                const processButton = document.createElement('button');
                processButton.textContent = 'Calculate';
                processButton.style.marginLeft = '10px';

                const resultSpan = document.createElement('span');
                resultSpan.className = 'result';

                processButton.addEventListener('click', () => {
                    const result = prompt('Enter result for this process:');
                    if (result) {
                        localStorage.setItem(`result${stageSelect.value}_${i}`, result);
                        resultSpan.textContent = result;
                        updateTotal(stageSelect.value);
                    }
                });

                resultSpan.textContent = localStorage.getItem(`result${stageSelect.value}_${i}`) || 0;
                processDiv.appendChild(processTypeSelect);
                processDiv.appendChild(processButton);
                processDiv.appendChild(resultSpan);
                processTypesContainer.appendChild(processDiv);
            }

            processTypeContainer.style.display = 'block';
            updateTotal(stageSelect.value);
        });
    </script>
</body>

</html>
